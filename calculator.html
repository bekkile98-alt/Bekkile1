<!doctype html>
<html lang="ru">
<head><link rel="stylesheet" type="text/css" href="style.css">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Калькулятор для богатых</title>
  <style>
    :root{
      --bg:#0f1724; --panel:#0b1220; --accent:#06b6d4; --muted:#94a3b8; --glass: rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box}
    body{font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial; margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center; background:linear-gradient(180deg,#071023 0%, #07121b 100%); color:#e6eef6}
    .container{width:360px; max-width:92vw; background:var(--panel); border-radius:16px; padding:18px; box-shadow:0 10px 30px rgba(2,6,23,0.7);}
    header{display:flex; align-items:center; gap:12px; margin-bottom:8px}
    .logo{width:44px; height:44px; border-radius:10px; background:linear-gradient(135deg,var(--accent),#7c3aed); display:flex; align-items:center; justify-content:center; font-weight:700}
    h1{font-size:16px; margin:0}
    p.sub{margin:0; color:var(--muted); font-size:12px}

    .screen{background:var(--glass); border-radius:10px; padding:16px; text-align:right; margin:14px 0; min-height:68px; display:flex; flex-direction:column; justify-content:center}
    .expression{font-size:13px; color:var(--muted); min-height:18px}
    .result{font-size:28px; font-weight:600; word-wrap:break-word}

    .keys{display:grid; grid-template-columns:repeat(4,1fr); gap:10px}
    button.key{padding:16px; border-radius:10px; border:0; font-size:16px; cursor:pointer; background:transparent; color:inherit; box-shadow:inset 0 -1px 0 rgba(255,255,255,0.02)}
    button.op{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.03)}
    button.equal{grid-column:span 2; background:linear-gradient(90deg,var(--accent),#7c3aed); color:#001219; font-weight:700}
    button.func{background:transparent; color:var(--muted)}

    footer{margin-top:12px; font-size:12px; color:var(--muted); display:flex; justify-content:space-between}
    @media (max-width:420px){ .result{font-size:22px} }
  </style>
</head>
<body>
  <div class="container" role="application" aria-label="Онлайн калькулятор">
    <header>
      <div class="logo">C</div>
      <div>
        <h1>Калькулятоор для богатых</h1>
        <p class="sub">Поддерживает клавиатуру и мобильные устройства</p>
      </div>
    </header>

    <div class="screen" id="screen">
      <div class="expression" id="expression">&nbsp;</div>
      <div class="result" id="result">0</div>
    </div>

    <div class="keys" id="keys">
      <button class="key func" data-action="clear">C</button>
      <button class="key func" data-action="back">←</button>
      <button class="key func" data-action="percent">%</button>
      <button class="key op" data-value="/">÷</button>

      <button class="key" data-value="7">7</button>
      <button class="key" data-value="8">8</button>
      <button class="key" data-value="9">9</button>
      <button class="key op" data-value="*">×</button>

      <button class="key" data-value="4">4</button>
      <button class="key" data-value="5">5</button>
      <button class="key" data-value="6">6</button>
      <button class="key op" data-value="-">−</button>

      <button class="key" data-value="1">1</button>
      <button class="key" data-value="2">2</button>
      <button class="key" data-value="3">3</button>
      <button class="key op" data-value="+">+</button>

      <button class="key" data-value="0">0</button>
      <button class="key" data-value=".">.</button>
      <button class="key func" data-action="paren">( )</button>
      <button class="key equal" data-action="equal">=</button>
    </div>

    <footer>
      <div>Нажмите Enter или = для вычисления</div>
      <div>Esc — очистить</div>
    </footer>
  </div>

  <script>
    (function(){
      const expressionEl = document.getElementById('expression');
      const resultEl = document.getElementById('result');
      let expr = '';

      function updateScreen(){
        expressionEl.textContent = expr || '\u00A0';
        resultEl.textContent = expr ? tryEval(expr) : '0';
      }

      function safeExpr(e){
        // replace visual operators with JS ones
        return e.replace(/×/g,'*').replace(/÷/g,'/').replace(/−/g,'-');
      }

      function tryEval(e){
        try{
          const s = safeExpr(e);
          // allow only digits, operators, parentheses, dot and spaces
          if(!/^[0-9+\-*/(). %]*$/.test(s)) return 'Ошибка';
          // percent handling: convert 'number%' to (number/100)
          const normalized = s.replace(/(\d+(?:\.\d+)?)%/g, '($1/100)');
          const val = Function('return '+normalized)();
          if(val === Infinity || val === -Infinity || Number.isNaN(val)) return 'Ошибка';
          // show integer without .0
          return Number.isFinite(val) ? (Number.isInteger(val) ? String(val) : String(+val.toFixed(10)).replace(/0+$/,'').replace(/\.$/,'')) : 'Ошибка';
        }catch(e){
          return '...';
        }
      }

      document.getElementById('keys').addEventListener('click', (ev)=>{
        const t = ev.target.closest('button');
        if(!t) return;
        const val = t.dataset.value;
        const action = t.dataset.action;
        if(val != null){
          // append value
          // prevent multiple dots in a single number segment
          if(val === '.'){
            // find last number segment
            const seg = expr.split(/[^0-9.]/).pop();
            if(seg && seg.includes('.')) return;
            if(!seg) expr += '0';
          }
          expr += val;
        }else if(action){
          if(action === 'clear') expr = '';
          else if(action === 'back') expr = expr.slice(0,-1);
          else if(action === 'percent') expr += '%';
          else if(action === 'paren'){
            // smart parentheses: add '(' if counts are equal or last char is an operator; otherwise add ')'
            const open = (expr.match(/\(/g)||[]).length;
            const close = (expr.match(/\)/g)||[]).length;
            const last = expr.slice(-1);
            if(open === close || /[+\-*/(]$/.test(last)) expr += '('; else expr += ')';
          }else if(action === 'equal'){
            expr = String( tryEval(expr) === 'Ошибка' || tryEval(expr) === '...' ? expr : tryEval(expr) );
          }
        }
        updateScreen();
      });

      // Keyboard support
      window.addEventListener('keydown',(e)=>{
        if(e.key >= '0' && e.key <= '9') { expr += e.key; updateScreen(); return; }
        if(e.key === '.') { expr += '.'; updateScreen(); return; }
        if(e.key === '+'|| e.key === '-'|| e.key === '*'|| e.key === '/') { expr += e.key; updateScreen(); return; }
        if(e.key === 'Enter' || e.key === '=') { e.preventDefault(); const r = tryEval(expr); if(r !== 'Ошибка' && r !== '...') expr = String(r); updateScreen(); return; }
        if(e.key === 'Backspace') { expr = expr.slice(0,-1); updateScreen(); return; }
        if(e.key === 'Escape') { expr = ''; updateScreen(); return; }
        if(e.key === '%'){ expr += '%'; updateScreen(); return; }
        if(e.key === '(' || e.key === ')'){ expr += e.key; updateScreen(); return; }
      });

      // init
      updateScreen();
    })();
  </script>
</body>
</html>
